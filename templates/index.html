<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Find f_ Variables</title>

<!-- PDF.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>

<!-- Mammoth (DOCX) -->
<script src="https://unpkg.com/mammoth/mammoth.browser.min.js"></script>

<style>
body {
    font-family: Arial, sans-serif;
    background: #f4f4f9;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 50px 20px;
    color: #333;
}
.container {
    background: #fff;
    padding: 20px 30px;
    border-radius: 12px;
    max-width: 600px;
    width: 100%;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
}
h1 {
    text-align: center;
    color: #2c3e50;
}
input[type="file"] {
    width: 100%;
    padding: 12px;
    margin-bottom: 15px;
    border-radius: 6px;
    border: 1px solid #ccc;
}
button {
    width: 100%;
    background-color: #FFC107;
    color: #fff;
    border: none;
    padding: 15px;
    font-size: 18px;
    border-radius: 8px;
    cursor: pointer;
    transition: 0.3s;
}
button:hover {
    background-color: #ffca28;
}
ul {
    list-style: none;
    padding: 0;
}
li {
    background: #ffedb6;
    margin: 6px 0;
    padding: 10px;
    border-radius: 6px;
    word-break: break-word;
}

/* ===== АДАПТИВНОСТЬ ===== */
@media (max-width: 600px) {
    body {
        padding: 20px 10px;
    }
    h1 {
        font-size: 24px;
    }
    input[type="file"] {
        padding: 10px;
        font-size: 16px;
    }
    button {
        padding: 12px;
        font-size: 16px;
    }
    .container {
        padding: 15px;
    }
    li {
        padding: 8px;
        font-size: 14px;
    }
}
</style>
</head>

<body>
<div class="container">
    <h1>Find f_ Variables</h1>

    <input type="file" id="files" multiple>
    <button onclick="analyze()">Анализировать</button>

    <ul id="result"></ul>
</div>

<script>
async function analyze() {
    const files = document.getElementById("files").files;
    let fullText = "";

    for (const file of files) {
        if (file.name.endsWith(".pdf")) {
            fullText += await readPDF(file);
        } else if (file.name.endsWith(".docx")) {
            fullText += await readDOCX(file);
        } else {
            fullText += await file.text();
        }
    }

    const response = await fetch("/analyze", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ text: fullText })
    });

    const vars = await response.json();
    const ul = document.getElementById("result");
    ul.innerHTML = "";

    vars.forEach(v => {
        const li = document.createElement("li");
        li.textContent = v;
        ul.appendChild(li);
    });
}

async function readPDF(file) {
    const buffer = await file.arrayBuffer();
    const pdf = await pdfjsLib.getDocument({ data: buffer }).promise;
    let text = "";
    for (let i = 1; i <= pdf.numPages; i++) {
        const page = await pdf.getPage(i);
        const content = await page.getTextContent();
        text += content.items.map(i => i.str).join(" ") + "\n";
    }
    return text;
}

async function readDOCX(file) {
    const buffer = await file.arrayBuffer();
    const result = await mammoth.extractRawText({ arrayBuffer: buffer });
    return result.value;
}
</script>
</body>
</html>
