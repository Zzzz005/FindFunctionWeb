<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Find f_ Variables</title>

<!-- PDF.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>

<!-- Mammoth (DOCX) -->
<script src="https://unpkg.com/mammoth/mammoth.browser.min.js"></script>

<style>
body {
    font-family: Arial, sans-serif;
    background: #f4f4f9;
    padding: 20px;
}
.container {
    max-width: 600px;
    margin: auto;
    background: #fff;
    padding: 20px;
    border-radius: 12px;
}
h1 {
    text-align: center;
}
input[type="file"] {
    width: 100%;
    padding: 12px;
    margin-bottom: 15px;
}
button {
    background: #FFC107;
    border: none;
    padding: 15px;
    width: 100%;
    font-size: 18px;
    border-radius: 8px;
    cursor: pointer;
}
ul {
    list-style: none;
    padding: 0;
}
li {
    background: #ffedb6;
    margin: 6px 0;
    padding: 10px;
    border-radius: 6px;
    word-break: break-word;
}
</style>
</head>

<body>
<div class="container">
    <h1>Find f_ Variables</h1>

    <input type="file" id="files" multiple>
    <button onclick="analyze()">Анализировать</button>

    <ul id="result"></ul>
</div>

<script>
async function analyze() {
    const files = document.getElementById("files").files;
    let fullText = "";

    for (const file of files) {
        if (file.name.endsWith(".pdf")) {
            fullText += await readPDF(file);
        } else if (file.name.endsWith(".docx")) {
            fullText += await readDOCX(file);
        } else {
            fullText += await file.text();
        }
    }

    const response = await fetch("/analyze", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ text: fullText })
    });

    const vars = await response.json();
    const ul = document.getElementById("result");
    ul.innerHTML = "";

    vars.forEach(v => {
        const li = document.createElement("li");
        li.textContent = v;
        ul.appendChild(li);
    });
}

async function readPDF(file) {
    const buffer = await file.arrayBuffer();
    const pdf = await pdfjsLib.getDocument({ data: buffer }).promise;
    let text = "";

    for (let i = 1; i <= pdf.numPages; i++) {
        const page = await pdf.getPage(i);
        const content = await page.getTextContent();
        text += content.items.map(i => i.str).join(" ") + "\n";
    }
    return text;
}

async function readDOCX(file) {
    const buffer = await file.arrayBuffer();
    const result = await mammoth.extractRawText({ arrayBuffer: buffer });
    return result.value;
}
</script>
</body>
</html>
